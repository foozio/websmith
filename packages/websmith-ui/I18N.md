# Internationalization (i18n) Guide

This document describes the internationalization (i18n) support in Websmith UI.

## Overview

Websmith UI provides a lightweight, React-friendly i18n solution that includes:

- **Translation Management**: Simple key-based translation system
- **React Integration**: Context, hooks, and components for React apps
- **Locale Formatting**: Built-in number, date, and relative time formatting
- **Multiple Languages**: Pre-configured English, Spanish, and French translations
- **Type Safety**: Full TypeScript support
- **Performance**: Minimal overhead, no external dependencies

## Quick Start

### 1. Wrap Your App with I18nProvider

```tsx
import { I18nProvider, defaultLocales } from '@websmith/ui'

function App() {
  return (
    <I18nProvider
      config={{
        locale: 'en',
        messages: defaultLocales,
        fallbackLocale: 'en'
      }}
    >
      <YourApp />
    </I18nProvider>
  )
}
```

### 2. Use Translations in Components

```tsx
import { useTranslation } from '@websmith/ui'

function MyComponent() {
  const { t } = useTranslation()
  
  return (
    <div>
      <h1>{t('common.hello')}</h1>
      <button>{t('common.save')}</button>
    </div>
  )
}
```

## Core Concepts

### Translation Keys

Translations use dot notation for nested keys:

```tsx
t('common.ok')           // "OK"
t('table.noData')        // "No data available"
t('form.required')       // "This field is required"
```

### Parameter Interpolation

Pass parameters to translations:

```tsx
t('table.showing', { start: 1, end: 10, total: 100 })
// "Showing 1 to 10 of 100 entries"

t('greeting', { name: 'John' })
// "Hello, John!"
```

### Locale Switching

Change locale dynamically:

```tsx
const { locale, setLocale } = useTranslation()

<select value={locale} onChange={(e) => setLocale(e.target.value)}>
  <option value="en">English</option>
  <option value="es">Español</option>
  <option value="fr">Français</option>
</select>
```

## API Reference

### I18nProvider

Provides i18n context to your app.

```tsx
<I18nProvider config={{
  locale: 'en',
  messages: {
    en: { hello: 'Hello' },
    es: { hello: 'Hola' }
  },
  fallbackLocale: 'en'
}}>
  {children}
</I18nProvider>
```

**Props:**
- `config.locale` - Initial locale (e.g., 'en', 'es', 'fr')
- `config.messages` - Translation messages object
- `config.fallbackLocale` - Fallback locale for missing translations

### useTranslation Hook

Access translation function and locale management.

```tsx
const { t, locale, setLocale, i18n } = useTranslation()
```

**Returns:**
- `t(key, params?)` - Translation function
- `locale` - Current locale
- `setLocale(locale)` - Change locale
- `i18n` - I18n instance for advanced usage

### useI18n Hook

Access full i18n context.

```tsx
const { i18n, locale, setLocale, t } = useI18n()
```

### Trans Component

Declarative translation component.

```tsx
<Trans i18nKey="common.hello" />
<Trans i18nKey="greeting" params={{ name: 'John' }} />
<Trans i18nKey="missing.key" fallback="Default text" />
```

**Props:**
- `i18nKey` - Translation key
- `params?` - Interpolation parameters
- `fallback?` - Fallback text if translation missing

### LocaleMatch Component

Conditional rendering based on locale.

```tsx
<LocaleMatch locale="en">
  <EnglishContent />
</LocaleMatch>

<LocaleMatch locale={['en', 'es']} fallback={<DefaultContent />}>
  <EnglishOrSpanishContent />
</LocaleMatch>
```

**Props:**
- `locale` - Locale or array of locales to match
- `children` - Content to render if locale matches
- `fallback?` - Content to render if locale doesn't match

### Formatting Hooks

#### useFormattedNumber

```tsx
const formatted = useFormattedNumber(1234.56, {
  style: 'currency',
  currency: 'USD'
})
// "$1,234.56"
```

#### useFormattedDate

```tsx
const formatted = useFormattedDate(new Date(), {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
})
// "January 15, 2024"
```

#### useFormattedRelativeTime

```tsx
const formatted = useFormattedRelativeTime(-1, 'day')
// "yesterday"
```

### Utility Functions

#### formatNumber

```tsx
import { formatNumber } from '@websmith/ui'

formatNumber(1234.56)
// "1,234.56" (based on current locale)
```

#### formatDate

```tsx
import { formatDate } from '@websmith/ui'

formatDate(new Date(), { dateStyle: 'full' })
// "Monday, January 15, 2024"
```

#### formatRelativeTime

```tsx
import { formatRelativeTime } from '@websmith/ui'

formatRelativeTime(-2, 'hour')
// "2 hours ago"
```

#### plural

```tsx
import { plural } from '@websmith/ui'

plural(0, { zero: 'no items', one: 'one item', other: '{count} items' })
// "no items"

plural(1, { one: 'one item', other: '{count} items' })
// "one item"

plural(5, { one: 'one item', other: '{count} items' })
// "{count} items"
```

## Built-in Translations

Websmith UI includes translations for common UI elements:

### Common

- Actions: ok, cancel, close, save, delete, edit, add, remove
- Navigation: back, next, previous, finish
- States: loading, error, success, warning, info
- Selection: select, selectAll, deselectAll
- Display: expand, collapse, showMore, showLess

### Components

- **Dialog**: title, close
- **Alert**: dismiss
- **Toast**: close
- **Table**: noData, rowsPerPage, pagination, sorting, filtering
- **Form**: validation messages (required, invalid, minLength, etc.)
- **Select**: placeholder, noOptions, search, loading
- **DatePicker**: months, weekdays, navigation
- **Pagination**: previous, next, page navigation
- **FileUpload**: dropzone, uploading, uploaded, failed
- **Accessibility**: ARIA labels and descriptions

## Adding Custom Translations

### Method 1: Extend Default Locales

```tsx
import { defaultLocales } from '@websmith/ui'

const customMessages = {
  en: {
    ...defaultLocales.en,
    myApp: {
      welcome: 'Welcome to my app',
      logout: 'Logout'
    }
  },
  es: {
    ...defaultLocales.es,
    myApp: {
      welcome: 'Bienvenido a mi aplicación',
      logout: 'Cerrar sesión'
    }
  }
}

<I18nProvider config={{ locale: 'en', messages: customMessages }}>
  {children}
</I18nProvider>
```

### Method 2: Add Messages Dynamically

```tsx
const { i18n } = useI18n()

i18n.addMessages('en', {
  myFeature: {
    title: 'My Feature',
    description: 'Feature description'
  }
})
```

## Creating New Locales

### 1. Create Translation File

```ts
// locales/de.ts
export const de = {
  common: {
    ok: 'OK',
    cancel: 'Abbrechen',
    close: 'Schließen',
    // ... more translations
  },
  // ... more sections
}
```

### 2. Add to Configuration

```tsx
import { defaultLocales } from '@websmith/ui'
import { de } from './locales/de'

const messages = {
  ...defaultLocales,
  de
}

<I18nProvider config={{ locale: 'de', messages }}>
  {children}
</I18nProvider>
```

## Advanced Usage

### Standalone I18n Instance

```tsx
import { I18n } from '@websmith/ui'

const i18n = new I18n({
  locale: 'en',
  messages: {
    en: { hello: 'Hello' },
    es: { hello: 'Hola' }
  }
})

i18n.t('hello') // "Hello"
i18n.setLocale('es')
i18n.t('hello') // "Hola"
```

### HOC for Class Components

```tsx
import { withI18n } from '@websmith/ui'

class MyComponent extends React.Component {
  render() {
    const { t } = this.props
    return <div>{t('common.hello')}</div>
  }
}

export default withI18n(MyComponent)
```

### Checking Translation Existence

```tsx
const { i18n } = useI18n()

if (i18n.has('optional.key')) {
  return <div>{t('optional.key')}</div>
}
```

### Getting Available Locales

```tsx
const { i18n } = useI18n()
const locales = i18n.getAvailableLocales()

<select>
  {locales.map(locale => (
    <option key={locale} value={locale}>{locale}</option>
  ))}
</select>
```

## Best Practices

### 1. Use Namespaces

Organize translations by feature or component:

```ts
{
  auth: {
    login: 'Login',
    logout: 'Logout',
    register: 'Register'
  },
  dashboard: {
    title: 'Dashboard',
    stats: 'Statistics'
  }
}
```

### 2. Keep Keys Descriptive

```ts
// ✅ Good
t('form.validation.emailInvalid')

// ❌ Avoid
t('err1')
```

### 3. Use Parameters for Dynamic Content

```ts
// ✅ Good
t('user.greeting', { name: user.name })

// ❌ Avoid
`${t('hello')} ${user.name}`
```

### 4. Provide Fallbacks

```tsx
<Trans 
  i18nKey="optional.feature" 
  fallback="Feature not available"
/>
```

### 5. Test All Locales

Ensure all translations are complete:

```ts
const requiredKeys = ['common.ok', 'common.cancel']

requiredKeys.forEach(key => {
  locales.forEach(locale => {
    if (!i18n.has(key)) {
      console.warn(`Missing translation: ${locale}.${key}`)
    }
  })
})
```

## Performance Tips

1. **Lazy Load Translations**: Load translations on demand for large apps
2. **Memoize Translations**: Use `useMemo` for expensive translations
3. **Avoid Inline Objects**: Define translation parameters outside render
4. **Use Trans Component**: For static translations without re-renders

## TypeScript Support

### Type-Safe Translation Keys

```ts
import { type TranslationKeys } from '@websmith/ui'

// Get autocomplete for translation keys
const key: keyof TranslationKeys = 'common.ok'
```

### Custom Message Types

```ts
interface MyMessages {
  myApp: {
    title: string
    description: string
  }
}

const messages: Record<string, MyMessages> = {
  en: {
    myApp: {
      title: 'My App',
      description: 'App description'
    }
  }
}
```

## Troubleshooting

### Translation Not Found

**Problem**: Warning "Translation not found for key: X"

**Solution**:
1. Check key spelling
2. Verify locale has the translation
3. Check fallback locale
4. Use `i18n.has(key)` to verify

### Locale Not Switching

**Problem**: Translations don't update after `setLocale`

**Solution**:
1. Ensure `I18nProvider` wraps your app
2. Use `useTranslation` hook, not direct `t` function
3. Check locale exists in messages

### Parameters Not Interpolating

**Problem**: `{param}` appears in output

**Solution**:
1. Pass params object: `t('key', { param: 'value' })`
2. Check parameter names match
3. Ensure translation string has `{param}` placeholder

## Examples

### Complete App Setup

```tsx
import { I18nProvider, defaultLocales } from '@websmith/ui'

const customMessages = {
  en: {
    ...defaultLocales.en,
    app: {
      title: 'My Application',
      welcome: 'Welcome, {name}!'
    }
  },
  es: {
    ...defaultLocales.es,
    app: {
      title: 'Mi Aplicación',
      welcome: '¡Bienvenido, {name}!'
    }
  }
}

function App() {
  return (
    <I18nProvider config={{
      locale: 'en',
      messages: customMessages,
      fallbackLocale: 'en'
    }}>
      <Router>
        <Routes />
      </Router>
    </I18nProvider>
  )
}
```

### Language Switcher Component

```tsx
import { useTranslation, getAvailableLocales } from '@websmith/ui'

function LanguageSwitcher() {
  const { locale, setLocale } = useTranslation()
  const locales = getAvailableLocales()
  
  return (
    <select 
      value={locale} 
      onChange={(e) => setLocale(e.target.value)}
      aria-label="Select language"
    >
      {locales.map(loc => (
        <option key={loc} value={loc}>
          {loc.toUpperCase()}
        </option>
      ))}
    </select>
  )
}
```

### Formatted Data Display

```tsx
import { 
  useFormattedNumber, 
  useFormattedDate, 
  useFormattedRelativeTime 
} from '@websmith/ui'

function DataDisplay({ price, date, daysAgo }) {
  const formattedPrice = useFormattedNumber(price, {
    style: 'currency',
    currency: 'USD'
  })
  
  const formattedDate = useFormattedDate(date, {
    dateStyle: 'medium'
  })
  
  const relativeTime = useFormattedRelativeTime(-daysAgo, 'day')
  
  return (
    <div>
      <p>Price: {formattedPrice}</p>
      <p>Date: {formattedDate}</p>
      <p>Posted: {relativeTime}</p>
    </div>
  )
}
```

## Resources

- [MDN: Intl API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [React Context](https://react.dev/reference/react/useContext)
- [CLDR Locale Data](http://cldr.unicode.org/)

## Contributing

To add a new locale:

1. Create translation file in `src/i18n/locales/`
2. Follow existing structure
3. Export from `src/i18n/locales/index.ts`
4. Add to `defaultLocales`
5. Test all translations
6. Submit PR with changeset
